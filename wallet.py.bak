import json
import subprocess
from subprocess import STDOUT, check_output
import os
import time
from datetime import datetime
import pytz
from pytz import timezone

date_format='%m/%d/%Y %H:%M:%S %Z'

while 1:
    
##wallet
    try:
        walletJSON = json.loads(subprocess.check_output(['ftx','wallet','--output','json'],stderr=STDOUT,timeout=8))
    except:
        print('read error')

    os.system('clear')
    
    date = datetime.now(tz=pytz.utc)
    date = date.astimezone(timezone('US/Pacific'))
    print(date.strftime(date_format))   

    for w in walletJSON['subaccounts']:
        #print(w)
        for b in w['balances']:
            i=0
            for key,value in b.items():
                if key=='currency':
                    print(value,end=' | ')
                elif key=='availableWithoutBorrowing':
                    print(round(value,3),end=' | ')
                elif key=='total':
                    print(round(value,3),end=' | ')
                elif key=='totalUsd':
                    print('$',round(value,3))
    
    for w in walletJSON['total']['balances']:
        print("Total:")
        i=0
        for key,value in w.items():
            if key=='currency':
                print(value,end=' | ')
            elif key=='availableWithoutBorrowing':
                print(round(value,3),end=' | ')
            elif key=='total':
                print(round(value,3),end=' | ')
            elif key=='totalUsd':
                print('$',round(value,3))

    
    time.sleep(1)
